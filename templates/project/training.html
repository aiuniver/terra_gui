{% extends 'project/base.html' %}

{% load static core_utils %}

{% block css_block %}
<link rel="stylesheet" href="{% static 'css/project/training.css' %}"/>
{% endblock css_block %}

{% block js_block %}
<script type="text/javascript" src="{% static 'js/project/plotly-latest.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/project/training.js' %}"></script>
{% endblock js_block %}

{% block content_block %}

<div class="toolbar project-training-toolbar">
    <div class="wrapper">
        <ul class="menu-section">
            <li data-type="charts">
                <span><img src="{% static 'imgs/model-menu-1.svg' %}" alt="" /></span>
            </li>
            <li data-type="images">
                <span><img src="{% static 'imgs/model-menu-2.svg' %}" alt="" /></span>
            </li>
            <li data-type="texts">
                <span><img src="{% static 'imgs/validation.svg' %}" alt="" /></span>
            </li>
            <li data-type="scatters">
                <span><img src="{% static 'imgs/validation.svg' %}" alt="" /></span>
            </li>
        </ul>
    </div>
</div>

<div class="board">
    <div class="graphics">
        <div class="wrapper">
            <div class="tabs-content">
                <div class="inner">
                    <div class="tabs-item graphics custom-scrollbar-wrapper">
                        <div class="tab-container">
                            <div class="charts">
                                <div class="category-title">Графики</div>
                                <div class="content"></div>
                            </div>
                            <div class="images">
                                <div class="category-title">Картинки</div>
                                <div class="content"></div>
                            </div>
                            <div class="texts">
                                <div class="category-title">Текст</div>
                                <div class="content"></div>
                            </div>
                            <div class="scatters">
                                <div class="category-title">Скаттеры</div>
                                <div class="content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="training-progress custom-scrollbar-wrapper">
        <div class="info"></div>
    </div>
</div>

<div class="properties project-training-properties">
    <div class="wrapper">
        <div class="params">
            <form class="params-container" novalidate="novalidate" autocomplete="off">
                <div class="params-item">
                    <div class="inner settings custom-scrollbar-wrapper">
                        <div class="params-item params-optimizer">
                            <div class="inner">
                                <div class="field-form field-inline">
                                    <label for="field_form-optimizer">Оптимизатор</label>
                                    <select id="field_form-optimizer" name="optimizer[name]" class="jquery-ui-menuselect">
                                        {% for name in request.terra_project.optimizers %}
                                            <option value="{{ name }}"{% if name == request.terra_project.training.optimizer.name %} selected="selected"{% endif %}>{{ name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="field-form form-inline-label">
                                    <div class="field-form field-inline">
                                        <label for="field_form-batch_sizes">Размер батча</label>
                                        <input name="batch_sizes" id="field_form-batch_sizes" type="number" value="{{ request.terra_project.training.batch_sizes }}" />
                                    </div>
                                    <div class="field-form field-inline">
                                        <label for="field_form-epochs_count">Количество эпох</label>
                                        <input name="epochs_count" id="field_form-epochs_count" type="number" value="{{ request.terra_project.training.epochs_count }}" />
                                    </div>
                                    <div class="field-form field-inline">
                                        <label for="field_form-learning_rate">Learning rate</label>
                                        <input name="optimizer[params][main][learning_rate]" id="field_form-learning_rate" type="number" value="" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="params-item params-optimizer-extra collapsable hidden">
                            <div class="params-title">Параметры оптимизатора</div>
                            <div class="inner form-inline-label"></div>
                        </div>

                        <div class="params-item params-output collapsable">
                            <div class="params-title">Параметры outputs слоев</div>
                            {% for layer in request.terra_project.layers.values %}
                                {% if layer.config.location_type == "output" %}
                                    <div class="inner">
                                        <div class="title">Слой <b>«{{ layer.config.name }}»</b></div>
                                        <div class="form-inline-label">
                                            <div class="field-form field-inline field-reverse">
                                                <label for="field_form-output-{{ layer.config.dts_layer_name }}-loss">Loss</label>
                                                <input type="hidden" name="outputs[{{ layer.config.dts_layer_name }}][task]" data-output="{{ layer.config.dts_layer_name }}" class="field_form-output_task field_form-{{ layer.config.dts_layer_name }}-output_task" />
                                                <select id="field_form-output-{{ layer.config.dts_layer_name }}-loss" name="outputs[{{ layer.config.dts_layer_name }}][loss]" data-output="{{ layer.config.dts_layer_name }}" class="jquery-ui-menuselect field_form-output_loss field_form-{{ layer.config.dts_layer_name }}-output_loss">
                                                    {% for task, items in request.terra_project.compile.items %}
                                                        <optgroup label="{{ task }}">
                                                            {% for loss in items.losses %}
                                                                <option value="{{ loss }}"{% task_loss_selected layer.config.dts_layer_name task loss %}>{{ loss }}</option>
                                                            {% endfor %}
                                                        </optgroup>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="field-form field-inline field-reverse">
                                                <label for="output-{{ layer.config.dts_layer_name }}-metric">Метрика</label>
                                                <select id="output-{{ layer.config.dts_layer_name }}-metric" name="outputs[{{ layer.config.dts_layer_name }}][metric][]" data-output="{{ layer.config.dts_layer_name }}" class="jquery-ui-menuselect field_form-output_metric field_form-{{ layer.config.dts_layer_name }}-output_metric" disabled="disabled"></select>
                                            </div>
                                            <div class="field-form field-inline field-reverse">
                                                <label for="output-{{ layer.config.dts_layer_name }}-num_classes">Количество классов</label>
                                                <input id="output-{{ layer.config.dts_layer_name }}-num_classes" name="outputs[{{ layer.config.dts_layer_name }}][num_classes]" data-output="{{ layer.config.dts_layer_name }}" class="field_form-output_num_classes field_form-{{ layer.config.dts_layer_name }}-output_num_classes" type="number" value="" />
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="params-item checkpoint-block collapsable hidden">
                            <div class="params-title">Checkpoint</div>
                            <div class="checkpoint-item inner form-inline-label">
                                 <div class="field-form field-inline output-block">
                                     <label for="display">Монитор:</label>
                                     <select id="display" class="jquery-ui-menuselect">
                                         <option value="none">none</option>
                                     </select>
                                 </div>
                                <div class="field-form field-inline output-block">
                                     <label for="mode">Режим:</label>
                                     <select id="mode" class="jquery-ui-menuselect">
                                         <option value="none">none</option>
                                     </select>
                                 </div>
                                <div class="switchers">
                                    <div class="field-form field-inline">
                                        <label for="save-best">Сохранить лучшее:</label>
                                        <div class="checkout-switch">
                                            <input type="checkbox" id="save-best" name="save-best"/>
                                            <span class="switcher"></span>
                                        </div>
                                    </div>
                                     <div class="field-form field-inline">
                                        <label for="save-weight">Сохранить веса:</label>
                                        <div class="checkout-switch">
                                            <input type="checkbox" id="save-weight" name="save-weight"/>
                                            <span class="switcher"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="params-item params-callbacks collapsable">
                            <div class="params-title">Выводить</div>
                            {% for layer in request.terra_project.layers.values %}
                                {% if layer.config.location_type == "output" %}
                                    <div class="inner callback-{{ layer.config.dts_layer_name }}">
                                        <div class="title">Слой <b>«{{ layer.config.name }}»</b></div>
                                        <div class="form-inline-label"></div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="params-item">
                    <div class="inner actions">
                        <div class="actions-form">
                            <div class="item training">
                                <button>Обучить</button>
                            </div>
                            <div class="item evaluate">
                                <button disabled="disabled">Evaluate</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock content_block %}

{% block modal_window %}
{{ block.super }}
<div id="modal-window-warning" class="modal-window-container">
    <div class="wrapper"></div>
</div>
{% endblock modal_window %}
