<!DOCTYPE html>
<html lang="">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>TerraAI</title>
	<meta name="theme-color" content="#fff">
	<meta name="msapplication-navbutton-color" content="#fff">
	<meta name="apple-mobile-web-app-status-bar-style" content="#fff">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<style type="text/css">
		html {
			line-height: 1.15;
			-webkit-text-size-adjust: 100%;
		}

		body {
			margin: 0;
		}

		main {
			display: block;
			height: 100%;
		}

		h1 {
			font-size: 2em;
			margin: 0;
		}

		hr {
			box-sizing: content-box;
			height: 0;
			overflow: visible;
		}

		pre {
			font-family: monospace, monospace;
			font-size: 1em;
		}

		a {
			background-color: transparent;
		}

		abbr[title] {
			border-bottom: none;
			text-decoration: underline;
			-webkit-text-decoration: underline dotted;
			text-decoration: underline dotted;
		}

		b,
		strong {
			font-weight: bolder;
		}

		code,
		kbd,
		samp {
			font-family: monospace, monospace;
			font-size: 1em;
		}

		small {
			font-size: 80%;
		}

		sub,
		sup {
			font-size: 75%;
			line-height: 0;
			position: relative;
			vertical-align: baseline;
		}

		sub {
			bottom: -0.25em;
		}

		sup {
			top: -0.5em;
		}

		img {
			border-style: none;
		}

		button,
		input,
		optgroup,
		select,
		textarea {
			font-family: inherit;
			font-size: 100%;
			line-height: 1.15;
			margin: 0;
		}

		button,
		input {
			overflow: visible;
		}

		button,
		select {
			text-transform: none;
		}

		button,
		[type="button"],
		[type="reset"],
		[type="submit"] {
			-webkit-appearance: button;
		}

		button::-moz-focus-inner,
		[type="button"]::-moz-focus-inner,
		[type="reset"]::-moz-focus-inner,
		[type="submit"]::-moz-focus-inner {
			border-style: none;
			padding: 0;
		}

		button:-moz-focusring,
		[type="button"]:-moz-focusring,
		[type="reset"]:-moz-focusring,
		[type="submit"]:-moz-focusring {
			outline: 1px dotted ButtonText;
		}

		fieldset {
			padding: 0.35em 0.75em 0.625em;
		}

		legend {
			box-sizing: border-box;
			color: inherit;
			display: table;
			max-width: 100%;
			padding: 0;
			white-space: normal;
		}

		progress {
			vertical-align: baseline;
		}

		textarea {
			overflow: auto;
		}

		[type="checkbox"],
		[type="radio"] {
			box-sizing: border-box;
			padding: 0;
		}

		[type="number"]::-webkit-inner-spin-button,
		[type="number"]::-webkit-outer-spin-button {
			height: auto;
		}

		[type="search"] {
			-webkit-appearance: textfield;
			outline-offset: -2px;
		}

		[type="search"]::-webkit-search-decoration {
			-webkit-appearance: none;
		}

		::-webkit-file-upload-button {
			-webkit-appearance: button;
			font: inherit;
		}

		details {
			display: block;
		}

		summary {
			display: list-item;
		}

		template {
			display: none;
		}

		[hidden] {
			display: none;
		}

		* {
			box-sizing: border-box;
		}

		html {
			height: 100%;
			width: 100%;
		}

		body {
			background-color: #0e1621;
			color: #fff;
			display: flex;
			flex-direction: column;
			height: 100%;
			font: 400 16px/1.5 "Open Sans", sans-serif;
			text-rendering: optimizeSpeed;
		}

		main {
			flex: 1 1 auto;

		}

		footer {
			flex: 0 0 30px;

			font-size: 11px;
			padding: 5px 0;
			line-height: 30px;
			padding: 0 10px;
			color: #a7bed3;
			text-align: center;
			background-color: #0e1621;
		}

		.container {
			max-width: 300px;
			margin: 0 auto;
			padding: 40px 25px;

		}

		.field {
			display: flex;
			flex-direction: column;
		}

		.col {
			margin: 0 0 30px 0;
		}

		.center {
			text-align: center;
		}

		.button {
			height: 60px;
			width: 100%;
			color: #fff;
			font-size: 1.125rem;
			cursor: pointer;
			background: #2b5278;
			border: 1px solid #65b9f4;
			border-radius: 4px;
			box-shadow: 0 1px 3px rgb(0 133 255 / 50%);
			transition: border-color 0.3s ease-in-out, box-shadow 0.1s ease-in-out;
		}

		.button:hover {
			border-color: #2b5278;
			box-shadow: 0 1px 3px 0 rgb(0 0 0 / 50%);

		}

		.field {
			/* max-width: 200px; */
		}

		.field .info {
			display: block;
			position: relative;
			line-height: 1.25;
			padding: 10px 15px 0 15px;
			color: #65B9F4;
			font-size: .75rem;
		}

		.field .info::before {
			/* display: block;
			content: '*';
			position: absolute;
			left: 15px;
			top: 12px; */
		}

		/* .field.error input {
			border-color: #f24343;
		} */

		label {
			position: relative;
		}

		.label {
			width: 100%;
			line-height: 20px;
			padding: 0 15px;
			position: absolute;
			left: 0;
			top: 20px;
			color: #A7BED3;
			font-size: 1.125rem;
			cursor: text;
			transition: top .1s ease-in-out, font-size .1s ease-in-out;
		}

		.field input {
			width: 100%;
			height: 60px;
			padding: 17px 15px 0 15px;
			color: #fff;
			font-size: 1.125rem;
			border: 1px solid #6C7883;
			background: #242F3D;
			transition: border-color .1s ease-in-out;
			border-radius: 4px;
		}

		.field input:focus {
			border: 1px solid #fff;
		}

		.focused {
			top: 8px;
			margin: 0;
			font-size: 11px;
		}


		.pt-10 {
			padding: 50px 0 0 0;
		}

		h1 {
			line-height: 1.75;
			margin: 0 0 30px 0;
			font-size: 1.125rem;
			font-weight: 600;
		}

		.alert {
			margin: 0 0 20px 0;
			font-size: .75rem;
			margin: 1rem auto;
			color: red;
			text-align: center;
			list-style-type: none;
		}

		ul {
			list-style-type: none;
			padding: 0;
		}
	</style>
</head>

<body>
	<main>
		<div class="container">
			<div class="row">
				<div class="col center">
					<h1>Войти в <b>TERRA AI <br />Laboratory</b></h1>
				</div>
				<div class="alert">
					<ul class="m-0">
						<li id="error"></li>
					</ul>
				</div>
				<div class="col">
					<label class="field">
						<span class="label" data-name="email">E-mail <small>*</small></span>
						<input id="email" name="email" type="email" />
						<span class="info"></span>
					</label>
				</div>
				<div class="col">
					<label class="field">
						<span class="label" data-name="token">Token <small>*</small></span>
						<input id="token" name="token" type="password" />
						<span class="info"></span>
					</label>
				</div>
			</div>
			<div class="col">
				<button id="submit" class="button">Войти</button>
			</div>
		</div>
	</main>
	<footer>

		<div class="footer-copyright">Copyright © «Университет искусственного интеллекта», 2022</div>

	</footer>
	<script>
		const email = document.getElementById('email');
		const token = document.getElementById('token');
		const submit = document.getElementById('submit');
		const error = document.getElementById('error');

		const fields = document.querySelectorAll('.field');
		const label = document.querySelectorAll('.label');

		const infoEmail = document.querySelector('#email + .info');
		const infoToken = document.querySelector('#token + .info');

		submit.addEventListener('click', onSubmit);
		email.addEventListener('blur', onBlur);
		token.addEventListener('blur', onBlur);
		email.addEventListener('focus', onFocus);
		token.addEventListener('focus', onFocus);
		email.addEventListener('keyup', (e) => {
			if (e.key === 'Enter') {
				if (token.value) {
					onSubmit()
				} else {
					token.focus()
				}
			}
		});
		token.addEventListener('keyup', (e) => {
			if (e.key === 'Enter') {
				onSubmit()
			}
		});

		function onSubmit(e) {
			if (!email.value || !token.value) {
				[...fields].forEach(element => {
					element.classList.add('error')
				});
				if (!email.value) infoEmail.innerHTML = '* Обязательное поле.'
				if (!token.value) infoToken.innerHTML = '* Обязательное поле.'
				return;
			}

			const data = {
				email: email.value,
				user_token: token.value
			}

			console.log(data)
			error.innerHTML = ''
			infoEmail.innerHTML = ''
			infoToken.innerHTML = ''

			fetch('/api/v1/login/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json;charset=utf-8'
				},
				body: JSON.stringify(data)
			})
				.then(response => response.json())
				.then((res) => {
					console.log(res);
					if (res.success) {
						window.location = res.data.url;
					} else {
						error.innerHTML = res.error.title
					}
					[...fields].forEach(element => {
						console.log(element.classList.remove('info'))
					});
				});
		}

		function onFocus(e) {
			const label = document.querySelector(`[data-name="${e.target.id}"]`);
			label.classList.add('focused')
		}

		function onBlur({ target }) {
			const label = document.querySelector(`[data-name="${target.id}"]`);
			if (!target.value) {
				label.classList.remove('focused')
			}

			// console.log(element.classList.remove('focused'))
			// [...label].forEach(element => {
			// 	console.log(element.classList.remove('focused'))
			// });
			// infoEmail.innerHTML = ''
			// infoToken.innerHTML = ''
		}
	</script>
</body>

</html>