(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f3890240"],{"0852":function(t,e,n){},"0db2":function(t,e,n){},"1ee4":function(t,e,n){},"290d":function(t,e,n){},"2a4f":function(t,e,n){},"44e7c":function(t,e,n){"use strict";n("4c60")},"44f0":function(t,e,n){},"492b":function(t,e,n){"use strict";n("0db2")},"4c60":function(t,e,n){},"5e99":function(t,e,n){"use strict";n("290d")},9131:function(t,e,n){"use strict";n("fbf1")},"9a7e":function(t,e,n){},a657:function(t,e,n){"use strict";n("0852")},aeed:function(t,e,n){"use strict";n("9a7e")},bd1f:function(t,e,n){"use strict";n("44f0")},d1b7:function(t,e,n){"use strict";n("2a4f")},ebfc:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",{staticClass:"page-cascades"},[n("div",{staticClass:"cont"},[n("LoadModel",{model:{value:t.dialogLoadModel,callback:function(e){t.dialogLoadModel=e},expression:"dialogLoadModel"}}),n("SaveModel",{attrs:{image:t.imageModel},model:{value:t.dialogSaveModel,callback:function(e){t.dialogSaveModel=e},expression:"dialogSaveModel"}}),n("Toolbar",{on:{actions:t.actions}}),n("Blocks",{ref:"container"}),n("Params"),n("CopyModal",{attrs:{title:"Код на keras"},model:{value:t.kerasModal,callback:function(e){t.kerasModal=e},expression:"kerasModal"}},[t._v(t._s(t.keras))]),n("DatasetsModal",{model:{value:t.dialogDatasets,callback:function(e){t.dialogDatasets=e},expression:"dialogDatasets"}})],1)])},s=[],a=n("1da1"),o=(n("fb6a"),n("caad"),n("96cf"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"toolbar"},[n("ul",{staticClass:"toolbar__menu"},[n("li",{class:["toolbar__menu--item",{disabled:!1}],attrs:{title:"Загрузить каскад"},on:{click:function(e){return t.click(e,"load")}}},[n("i",{staticClass:"t-icon icon-model-load"})]),n("li",{class:["toolbar__menu--item",{disabled:!1}],attrs:{title:"Очистить"},on:{click:function(e){return t.click(e,"clear")}}},[n("i",{staticClass:"t-icon icon-model-clear"})]),n("hr"),n("li",{class:["toolbar__menu--item",{disabled:!1}],attrs:{title:"Входящий слой"},on:{click:function(e){return e.preventDefault(),t.click(e,"InputData")}}},[n("i",{staticClass:"t-icon icon-layer-input-casc"})]),n("li",{staticClass:"toolbar__menu--item",attrs:{title:"Model"},on:{click:function(e){return e.preventDefault(),t.click(e,"Model")}}},[n("i",{staticClass:"t-icon icon-layer-model"})]),n("li",{staticClass:"toolbar__menu--item",attrs:{title:"Function"},on:{click:function(e){return e.preventDefault(),t.click(e,"Function")}}},[n("i",{staticClass:"t-icon icon-layer-function"})]),n("li",{staticClass:"toolbar__menu--item",attrs:{title:"Custom"},on:{click:function(e){return e.preventDefault(),t.click(e,"Custom")}}},[n("i",{staticClass:"t-icon icon-layer-custom"})]),n("li",{staticClass:"toolbar__menu--item",attrs:{title:"Service"},on:{click:function(e){return e.preventDefault(),t.click(e,"Service")}}},[n("i",{staticClass:"t-icon icon-layer-service"})]),n("li",{class:["toolbar__menu--item",{disabled:!1}],attrs:{title:"Исходящий слой"},on:{click:function(e){return e.preventDefault(),t.click(e,"OutputData")}}},[n("i",{staticClass:"t-icon icon-layer-output"})]),n("hr"),n("li",{class:["toolbar__menu--item",{disabled:t.isValidation}],attrs:{title:"Валидация"},on:{click:function(e){return t.click(e,"validation")}}},[n("i",{staticClass:"t-icon icon-model-validation"})]),n("li",{class:["toolbar__menu--item",{disabled:t.isStart}],attrs:{title:"Запустить"},on:{click:function(e){return t.click(e,"start")}}},[n("i",{staticClass:"t-icon icon-model-play"})]),n("li",{class:["toolbar__menu--item",{disabled:t.isSave}],attrs:{title:"Сохранить каскад"},on:{click:function(e){return t.click(e,"save")}}},[n("i",{staticClass:"t-icon icon-model-save"})])])])}),r=[],c=n("2909"),l=n("5530"),u=(n("d81d"),n("2532"),n("7db0"),n("2f62")),d={name:"Toolbar",data:function(){return{}},computed:Object(l["a"])(Object(l["a"])({},Object(u["c"])({blocks:"cascades/getBlocks",errors:"cascades/getErrorsBlocks",project:"projects/getProject",status:"cascades/getStatus"})),{},{isValidation:function(){var t=this.blocks.map((function(t){return t.group}));return!(t.includes("InputData")&&t.includes("OutputData"))},isStart:function(){return this.isValidation||this.status.validate},isSave:function(){return this.isStart||this.status.start},isInput:function(){var t;return!!this.blocks.find((function(t){return"InputData"===t.group}))&&!(null===(t=this.project)||void 0===t||!t.dataset)},isOutput:function(){var t;return!!this.blocks.find((function(t){return"OutputData"===t.group}))&&!(null===(t=this.project)||void 0===t||!t.dataset)}}),methods:{click:function(t,e){var n=t.currentTarget,i=Object(c["a"])(null===n||void 0===n?void 0:n.classList)||[];i.includes("disabled")||this.$emit("actions",e)}}},h=d,m=(n("aeed"),n("2877")),f=Object(m["a"])(h,o,r,!1,null,"bc75f2b0",null),p=f.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"t-block",on:{contextmenu:t.contextmenu}},[n("Net",{staticClass:"t-block__center",attrs:{x:t.centerX,y:t.centerY,scale:t.scale}}),n("VueLink",{staticClass:"t-block__lines",attrs:{lines:t.lines}}),t._l(t.blocks,(function(e){return n("VueBlock",t._b({key:e.id,ref:"block_"+e.id,refInFor:!0,attrs:{options:t.optionsForChild,linkingCheck:t.tempLink,icons:t.icons,filter:t.filter,errors:t.errors},on:{linkingStart:function(n){return t.linkingStart(e,n)},linkingStop:function(n){return t.linkingStop(e,n)},linkingBreak:function(n){return t.linkingBreak(e,n)},select:function(n){return t.blockSelect(e)},position:function(n){return t.position(e,n)},moveBlock:t.moveBlock,clickIcons:function(n){return t.clickIcons(n,e)}}},"VueBlock",e,!1))})),n("div",{staticClass:"btn-zoom"},[n("div",{staticClass:"btn-zoom__item"},[n("i",{staticClass:"t-icon icon-zoom-inc",on:{click:function(e){return t.zoom(1)}}})]),n("hr"),n("div",{staticClass:"btn-zoom__item"},[n("i",{staticClass:"t-icon icon-zoom-reset",on:{click:function(e){return t.zoom(0)}}})]),n("hr"),n("div",{staticClass:"btn-zoom__item"},[n("i",{staticClass:"t-icon icon-zoom-dec",on:{click:function(e){return t.zoom(-1)}}})])])],2)},g=[],k=n("b85c"),b=(n("4de4"),n("c740"),n("99af"),n("c7a7")),y=n.n(b),x=n("f69e"),_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"t-block-cascades",style:t.style,on:{mouseover:function(e){t.hover=!0},mouseleave:function(e){t.hover=!1}}},[n("div",{class:["t-block-cascades__header",t.group,{selected:t.selected},{error:!!t.error}]},[n("div",{staticClass:"t-block-cascades__header--title",attrs:{title:t.name}},[t._v(t._s(t.id+") "+t.group+": "+t.name))]),n("div",{staticClass:"t-block-cascades__header--parametr",attrs:{title:t.parametr}},[t._v(t._s(t.parametr))])]),n("div",{staticClass:"t-block-cascades__base"}),t.error?n("div",{directives:[{name:"show",rawName:"v-show",value:t.hover||t.selected,expression:"hover || selected"}],staticClass:"t-block-cascades__error"},[t._v(" "+t._s(t.error)+" ")]):t._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:t.hover||t.selected,expression:"hover || selected"}],staticClass:"t-block-cascades__hover",style:t.styleHover},[t._l(t.iconsFilter,(function(e,i){return[n("i",{key:"icon_"+i,class:["t-icon",e.icon],on:{click:function(n){return t.$emit("clickIcons",e)}}})]}))],2),n("div",{staticClass:"t-block-cascades__inputs"},t._l(t.inputs,(function(e,i){return n("div",{key:"input"+i,staticClass:"input inputSlot",class:{active:e.active,"input--linking-active":t.linkingCheck&&!t.linking},on:{mouseup:function(e){return t.slotMouseUp(e,i)},mousedown:function(e){return t.slotBreak(e,i)}}})})),0),n("div",{staticClass:"t-block-cascades__outputs"},t._l(t.outputs,(function(e,i){return n("div",{key:"output"+i,staticClass:"output",class:[{active:t.hover&&!t.linkingCheck},t.typeLink[i]],on:{mousedown:function(e){return t.slotMouseDown(e,i)}}})})),0)])},w=[],C=(n("a9e3"),n("07ac"),n("a15b"),{name:"VueBlock",props:{id:{type:Number},linkingCheck:{type:Object},errors:{type:Object,default:function(){}},name:{type:String},group:{type:String},position:{type:Array,default:function(){return[]},validator:function(t){return"number"===typeof t[0]&&"number"===typeof t[1]}},selected:Boolean,typeLabel:String,title:{type:String,default:"Title"},inputs:Array,outputs:Array,parameters:{type:Object,default:function(){}},options:{type:Object},icons:Array,filter:{type:Object,default:function(){}},shape:Object,bind:Object},data:function(){return{hover:!1,hasDragged:!1,typeLink:["bottom","right","left"]}},computed:{iconsFilter:function(){var t=this;return this.icons.filter((function(e){return t.filter[t.group].includes(e.event)}))},error:function(){var t;return(null===(t=this.errors)||void 0===t?void 0:t[this.id])||""},parametr:function(){var t,e=Object.values((null===(t=this.parameters)||void 0===t?void 0:t.main)||{}).filter((function(t){return t})),n=this.group;if(console.log(n),console.log(e),"Function"===n){var i,s=(null===(i=this.parameters)||void 0===i?void 0:i.main)||{},a=s.type,o=s.group;return"".concat(o," ").concat(a)}if("Service"===n){var r,c=(null===(r=this.parameters)||void 0===r?void 0:r.main)||{},l=c.type,u=c.group;return"".concat(u," ").concat(l)}if("Model"===n){var d,h=(null===(d=this.parameters)||void 0===d?void 0:d.main)||{},m=h.path;return"".concat(m)}if("InputData"===n){var f,p=(null===(f=this.parameters)||void 0===f?void 0:f.main)||{},v=p.type;return"".concat(v)}return e.join(" ")},styleHover:function(){var t=this.iconsFilter.length;return{right:-32*t-3+"px"}},style:function(){return{left:this.options.center.x+this.position[0]*this.options.scale+"px",top:this.options.center.y+this.position[1]*this.options.scale+"px",width:this.options.width+"px",transform:"scale("+this.options.scale+")",transformOrigin:"top left",zIndex:this.selected||this.hover?10:1}}},created:function(){this.mouseX=0,this.mouseY=0,this.lastMouseX=0,this.lastMouseY=0,this.linking=!1,this.dragging=!1},mounted:function(){document.documentElement.addEventListener("mousemove",this.handleMove,!0),document.documentElement.addEventListener("mousedown",this.handleDown,!0),document.documentElement.addEventListener("mouseup",this.handleUp,!0)},beforeDestroy:function(){document.documentElement.removeEventListener("mousemove",this.handleMove,!0),document.documentElement.removeEventListener("mousedown",this.handleDown,!0),document.documentElement.removeEventListener("mouseup",this.handleUp,!0)},methods:{getHeight:function(){return this.$el.clientHeight},handleMove:function(t){if(this.mouseX=t.pageX||t.clientX+document.documentElement.scrollLeft,this.mouseY=t.pageY||t.clientY+document.documentElement.scrollTop,this.dragging&&!this.linking){var e=this.mouseX-this.lastMouseX,n=this.mouseY-this.lastMouseY;this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY,this.moveWithDiff(e,n),this.hasDragged=!0}},handleDown:function(t){this.mouseX=t.pageX||t.clientX+document.documentElement.scrollLeft,this.mouseY=t.pageY||t.clientY+document.documentElement.scrollTop,this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY;var e=t.target||t.srcElement;this.$el.contains(e)&&1===t.which&&(this.dragging=!0,this.$emit("select"),t.preventDefault&&t.preventDefault())},handleUp:function(){this.dragging&&(this.dragging=!1,this.hasDragged&&(this.$emit("moveBlock"),this.save(),this.hasDragged=!1)),this.linking&&(this.linking=!1)},slotMouseDown:function(t,e){this.linking=!0,this.$emit("linkingStart",e),t.preventDefault&&t.preventDefault()},slotMouseUp:function(t,e){this.$emit("linkingStop",e),t.preventDefault&&t.preventDefault()},slotBreak:function(t,e){this.linking=!0,this.$emit("linkingBreak",e),t.preventDefault&&t.preventDefault()},save:function(){this.$emit("update")},moveWithDiff:function(t,e){var n=this.position[0]+t/this.options.scale,i=this.position[1]+e/this.options.scale;this.$emit("position",[n,i])}}}),M=C,$=(n("9131"),Object(m["a"])(M,_,w,!1,null,"1b783f8c",null)),D=$.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{width:"100%",height:"100%"}},[t._l(t.renderedPathes,(function(e,i){return n("g",{key:"k"+i},[t.outline?n("path",{style:e.outlineStyle,attrs:{d:e.data}}):t._e(),t.outline?t._e():n("circle",{attrs:{cx:e.circle[0],cy:e.circle[1],r:3*e.scale,fill:e.style.stroke}}),t.outline?t._e():n("circle",{attrs:{cx:e.circle[2],cy:e.circle[3],r:3*e.scale,fill:e.style.stroke}}),n("path",{style:e.style,attrs:{d:e.data}})])})),n("g",t._l(t.renderedArrows,(function(t,e){return n("path",{key:"a"+e,style:t.style,attrs:{d:"M -1 -1 L 0 1 L 1 -1 z",transform:t.transform}})})),0)],2)},S=[],j=(n("159b"),{props:{lines:{type:Array,default:function(){return[]}},outline:{type:Boolean,default:!1}},methods:{distance:function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))},computeConnectionPoint:function(t,e,n,i,s){var a=this.distance(t,e,n,i),o={x:t,y:e},r={x:t+.25*a,y:e},c={x:n-.25*a,y:i},l={x:n,y:i},u=(1-s)*(1-s)*(1-s),d=(1-s)*(1-s)*3*s,h=3*(1-s)*(s*s),m=s*s*s,f=u*o.x+d*r.x+h*c.x+m*l.x,p=u*o.y+d*r.y+h*c.y+m*l.y;return{x:f,y:p}}},computed:{renderedPathes:function(){var t=this;if(!this.lines)return[];var e=[];return this.lines.forEach((function(n){var i=.2*t.distance(n.x1,n.y1,n.x2,n.y2),s=[n.x1,n.y1,n.x2,n.y2],a=["M ".concat(n.x1,", ").concat(n.y1," C ").concat(n.x1,", ").concat(n.y1+i,", ").concat(n.x2,", ").concat(n.y2-i,", ").concat(n.x2,", ").concat(n.y2),"M ".concat(n.x1,", ").concat(n.y1," C ").concat(n.x1+i,", ").concat(n.y1,", ").concat(n.x2-i,", ").concat(n.y2,", ").concat(n.x2,", ").concat(n.y2),"M ".concat(n.x1,", ").concat(n.y1," C ").concat(n.x1-i,", ").concat(n.y1,", ").concat(n.x2+i,", ").concat(n.y2,", ").concat(n.x2,", ").concat(n.y2)];e.push({data:a[n.slot]||a[0],circle:s,scale:n.scale||1,style:n.style,outlineStyle:n.outlineStyle})})),e},renderedArrows:function(){var t=this;if(!this.lines)return[];var e=[];return this.lines.forEach((function(n){var i=t.computeConnectionPoint(n.x1,n.y1,n.x2,n.y2,.5),s=t.computeConnectionPoint(n.x1,n.y1,n.x2,n.y2,.501),a=-Math.atan2(s.x-i.x,s.y-i.y),o=180*(a>=0?a:2*Math.PI+a)/Math.PI;e.push({transform:"translate(".concat(i.x,", ").concat(i.y,") rotate(").concat(o-15,")"),style:{stroke:"rgb(80, 125, 150)",strokeWidth:2*n.style.strokeWidth,fill:n.style.stroke}})})),e}}}),L=j,E=Object(m["a"])(L,O,S,!1,null,"552b6f12",null),B=E.exports,Y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{width:"100%",height:"100%"}},[n("line",{style:t.line.style,attrs:{x1:t.endpointX,y1:0,x2:t.endpointX,y2:t.lenghtPoint}}),n("line",{style:t.line.style,attrs:{x1:t.endpointX,y1:t.lengthHeight,x2:t.endpointX,y2:t.lengthHeight-t.lenghtPoint}}),n("line",{style:t.line.style,attrs:{x1:0,y1:t.endpointY,x2:t.lenghtPoint,y2:t.endpointY}}),n("line",{style:t.line.style,attrs:{x1:t.lengthWidth,y1:t.endpointY,x2:t.lengthWidth-t.lenghtPoint,y2:t.endpointY}}),n("line",{style:t.line.style,attrs:{x1:t.x,y1:t.y-t.line.dist,x2:t.x,y2:t.y+t.line.dist}}),n("line",{style:t.line.style,attrs:{x1:t.x-t.line.dist,y1:t.y,x2:t.x+t.line.dist,y2:t.y}}),t.$config.isDev?n("g",[t._l(t.qtyXdown,(function(e){return[n("line",{key:"key_X_down_"+e,style:t.style,attrs:{x1:0,y1:t.y+t.pixel*e,x2:t.lengthWidth,y2:t.y+t.pixel*e}})]})),t._l(t.qtyXup,(function(e,i){return[n("line",{key:"key_X_up_"+e,style:t.style,attrs:{x1:0,y1:t.y-t.pixel*i,x2:t.lengthWidth,y2:t.y-t.pixel*i}})]})),t._l(t.qtyYleft,(function(e){return[n("line",{key:"key_Y_down_"+e,style:t.style,attrs:{x1:t.x+t.pixel*e,y1:0,x2:t.x+t.pixel*e,y2:t.lengthHeight}})]})),t._l(t.qtyYright,(function(e,i){return[n("line",{key:"key_Y_up_"+e,style:t.style,attrs:{x1:t.x-t.pixel*i,y1:0,x2:t.x-t.pixel*i,y2:t.lengthHeight}})]}))],2):t._e()])},X=[],I=n("eb4c"),R={props:{x:Number,y:Number,scale:Number},data:function(){return{lenghtPoint:10,show:.6,cell:20,width:0,height:0,color:"#6c7883",debounce:null}},computed:{qtyXdown:function(){var t=Math.round((this.height-this.y)/this.pixel);return t<0||this.scale<this.show?0:t},qtyXup:function(){var t=Math.round((this.height+this.y)/this.pixel);return t<0||this.scale<this.show?0:t},qtyYright:function(){var t=Math.round((this.width+this.x)/this.pixel);return t<0||this.scale<this.show?0:t},qtyYleft:function(){var t=Math.round((this.width-this.x)/this.pixel);return t<0||this.scale<this.show?0:t},endpointX:function(){return this.x>0?this.x>this.width?this.width-1:this.x:0},endpointY:function(){return this.y>0?this.y>this.height?this.height-1:this.y:0},pixel:function(){return this.cell*this.scale},lengthHeight:function(){return this.height},lengthWidth:function(){return this.width},style:function(){return{stroke:"#6c78832f",strokeWidth:.5*this.scale}},line:function(){var t=60*this.scale;return{dist:t,style:{stroke:this.color,strokeWidth:.5*this.scale}}}},methods:{event:function(t){this.debounce(t)}},mounted:function(){var t,e,n=this;this.width=null===(t=this.$el)||void 0===t?void 0:t.clientWidth,this.height=null===(e=this.$el)||void 0===e?void 0:e.clientHeight,this.debounce=Object(I["a"])((function(){var t,e;n.width=null===(t=n.$el)||void 0===t?void 0:t.clientWidth,n.height=null===(e=n.$el)||void 0===e?void 0:e.clientHeight}),200),window.addEventListener("resize",this.event)},destroyed:function(){window.removeEventListener("resize",this.event)}},P=R,N=Object(m["a"])(P,Y,X,!1,null,"16280710",null),W=N.exports,F={name:"VueBlockContainer",components:{VueBlock:D,VueLink:B,Net:W},props:{blocksContent:{type:Array,default:function(){return[]}},options:{type:Object}},data:function(){return{icons:[{icon:"icon-modeling-copy-white",event:"clone"},{icon:"icon-modeling-link-remove",event:"link"},{icon:"icon-modeling-remove",event:"remove"}],dragging:!1,centerX:0,centerY:0,scale:1,tempLink:null,selectedBlock:null,hasDragged:!1,mouseX:0,mouseY:0,lastMouseX:0,lastMouseY:0,minScale:.2,maxScale:5,linking:!1,linkStartData:null,inputSlotClassName:"inputSlot",defaultScene:{blocks:[],links:[],container:{}}}},computed:Object(l["a"])(Object(l["a"])({},Object(u["c"])({project:"projects/getProject"})),{},{scaleCenter:function(){return{top:this.centerY+"px",left:this.centerX+"px",transform:"scale("+this.scale+")",transformOrigin:"top left"}},filter:function(){return{InputData:this.blocks.filter((function(t){return"InputData"===t.group})).length>1?["clone","link","remove"]:["link"],Model:["clone","link","remove"],Function:["clone","link","remove"],Custom:["clone","link","remove"],Service:["clone","link","remove"],OutputData:this.blocks.filter((function(t){return"OutputData"===t.group})).length>1?["clone","link","remove"]:["link"]}},errors:function(){return this.$store.getters["cascades/getErrorsBlocks"]},blocks:{set:function(t){this.$store.dispatch("cascades/setBlocks",t)},get:function(){return this.$store.getters["cascades/getBlocks"]}},block:function(){return this.$store.getters["cascades/getBlock"]},links:{set:function(t){console.log(t),this.$store.dispatch("cascades/setLinks",t)},get:function(){return this.$store.getters["cascades/getLinks"]}},optionsForChild:function(){return{width:180,titleHeight:42,scale:this.scale,inputSlotClassName:this.inputSlotClassName,center:{x:this.centerX,y:this.centerY}}},container:function(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}},lines:function(){var t,e=this,n=[],i=Object(k["a"])(this.links);try{var s=function(){var i,s,a=t.value,o=e.blocks.find((function(t){return t.id===a.originID})),r=e.blocks.find((function(t){return t.id===a.targetID}));if(!o||!r)return console.log("Remove invalid link",a),e.$store.dispatch("cascades/removeLink",a.id),"continue";if(o.id===r.id)return console.log("Loop detected, remove link",a),e.$store.dispatch("cascades/removeLink",a.id),"continue";var c=e.getConnectionPos(o,a.originSlot,!1),l=e.getConnectionPos(r,a.targetSlot,!0);if(!c||!l)return console.log("Remove invalid link (slot not exist)",a),e.$store.dispatch("cascades/removeLink",a.id),"continue";var u=c.x,d=c.y,h=l.x,m=l.y,f=o.id===((null===(i=e.block)||void 0===i?void 0:i.id)||-1)||r.id===((null===(s=e.block)||void 0===s?void 0:s.id)||-1);n.push({x1:u,y1:d,x2:h,y2:m,slot:a.originSlot,scale:e.scale,style:{stroke:f?"#a0d5f9":"#467ca1",strokeWidth:2*e.scale,fill:"none",zIndex:999},outlineStyle:{stroke:"#666",strokeWidth:2*e.scale,strokeOpacity:.6,fill:"none",zIndex:999}})};for(i.s();!(t=i.n()).done;)s()}catch(a){i.e(a)}finally{i.f()}return this.tempLink&&(this.tempLink.style={stroke:"#8f8f8f",strokeWidth:2*this.scale,fill:"none"},n.push(this.tempLink)),n}}),methods:{contextmenu:function(t){this.$config.isDev||t.preventDefault()},getCenter:function(){this.scale>1.5&&(this.scale=1.5);var t=this.$el.clientWidth/2-this.optionsForChild.width/2-this.centerX,e=this.$el.clientHeight/2-this.centerY;return console.log(this.centerX),console.log(this.centerY),[t,e]},getError:function(t){var e;return(null===(e=this.errorsBlocks)||void 0===e?void 0:e[t])||""},clickIcons:function(t,e){var n=t.event;console.log(n),"remove"===n&&this.$store.dispatch("cascades/removeBlock",e),"clone"===n&&this.$store.dispatch("cascades/cloneBlock",e),"link"===n&&this.$store.dispatch("cascades/removeLinkToBlock",e)},handleMauseOver:function(t){this.mouseIsOver="mouseenter"===t.type},keyup:function(t){var e=t.code,n=t.ctrlKey,i=this.mouseIsOver;console.log(i,e),i&&"Delete"===e&&this.selectedBlock,i&&"KeyC"===e&&n&&this.selectedBlock},zoom:function(t){if(0===t)return this.scale=1,this.centerX=this.$el.clientWidth/2,void(this.centerY=this.$el.clientHeight/2);var e=1===t?1.1:.9090909090909091;if(this.scale*=e,this.scale<this.minScale)this.scale=this.minScale;else if(this.scale>this.maxScale)this.scale=this.maxScale;else{var n=(this.$el.clientWidth/2-this.centerX)*(e-1),i=(this.$el.clientHeight/2-this.centerY)*(e-1);this.centerX-=n,this.centerY-=i}},handleMove:function(t){var e=Object(x["d"])(this.$el,t);if(this.mouseX=e.x,this.mouseY=e.y,this.dragging){console.log("handleMove");var n=this.mouseX-this.lastMouseX,i=this.mouseY-this.lastMouseY;this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY,this.centerX+=n,this.centerY+=i,this.hasDragged=!0}if(this.linking&&this.linkStartData){var s=this.getConnectionPos(this.linkStartData.block,this.linkStartData.slotNumber,!1);this.tempLink={x1:s.x,y1:s.y,x2:this.mouseX,y2:this.mouseY,slot:this.linkStartData.slotNumber}}},handleDown:function(t){console.log("handleDown");var e=t.target||t.srcElement;if((e===this.$el||e.matches("svg, svg *"))&&1===t.which){this.dragging=!0;var n=Object(x["d"])(this.$el,t);this.mouseX=n.x,this.mouseY=n.y,this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY,this.$store.dispatch("cascades/deselectBlocks"),t.preventDefault&&t.preventDefault()}},handleUp:function(t){console.log("handleUp");var e=t.target||t.srcElement;this.dragging&&(this.dragging=!1,this.hasDragged&&(this.hasDragged=!1)),!this.$el.contains(e)||"string"===typeof e.className&&e.className.includes(this.inputSlotClassName)||(this.linking=!1,this.tempLink=null,this.linkStartData=null)},handleWheel:function(t){var e=t.target||t.srcElement;if(this.$el.contains(e)){var n=Math.pow(1.1,-.01*t.deltaY);if(this.scale*=n,this.scale<this.minScale)return void(this.scale=this.minScale);if(this.scale>this.maxScale)return void(this.scale=this.maxScale);var i={x:this.mouseX,y:this.mouseY},s=(i.x-this.centerX)*(n-1),a=(i.y-this.centerY)*(n-1);this.centerX-=s,this.centerY-=a}},getConnectionPos:function(t,e,n){if(t&&-1!==e){var i=0,s=0;if(i+=t.position[0],s+=t.position[1],n&&t.inputs.length>e)1===t.inputs.length?(i+=this.optionsForChild.width/2,s+=-3):(i+=this.optionsForChild.width/2-10*t.inputs.length/2,i+=20*e);else{if(n||!(t.outputs.length>e))return void console.error("slot "+e+" not found, is input: "+n,t);var a,o,r;0===e&&(i+=this.optionsForChild.width/2,s+=(null===(a=this.$refs)||void 0===a||null===(o=a["block_"+t.id])||void 0===o||null===(r=o[0])||void 0===r?void 0:r.getHeight())||55);1===e&&(i+=this.optionsForChild.width,s+=25),2===e&&(s+=25)}return i*=this.scale,s*=this.scale,i+=this.centerX,s+=this.centerY,{x:i,y:s}}},findindexBlock:function(t){return this.blocks.findIndex((function(e){return e.id===t}))},linkingStart:function(t,e){console.log("linkingStart"),this.linkStartData={block:t,slotNumber:e};var n=this.getConnectionPos(this.linkStartData.block,this.linkStartData.slotNumber,!1);this.tempLink={x1:n.x,y1:n.y,x2:this.mouseX,y2:this.mouseY},this.linking=!0},linkingStop:function(t,e){if(console.log("linkingStop"),console.log(t),console.log(this.linkStartData),this.linkStartData.block.id,this.linkStartData&&t&&e>-1){var n=this.linkStartData,i=n.slotNumber,s=n.block.id,a=t.id,o=e;this.links=this.links.filter((function(t){return!(t.targetID===a&&t.targetSlot===o&&t.originID===s&&t.originSlot===i)&&!(t.targetID===s&&t.originID===a||t.originID===s&&t.targetID===a)}));var r=Math.max.apply(Math,[0].concat(Object(c["a"])(this.links.map((function(t){return t.id})))));if(this.linkStartData.block.id!==t.id){var l=this.linkStartData.block.id,u=this.linkStartData.slotNumber,d=t.id,h=e;this.links.push({id:r+1,originID:l,originSlot:u,targetID:d,targetSlot:h}),this.updateModel()}}this.linking=!1,this.tempLink=null,this.linkStartData=null},linkingBreak:function(t,e){if(console.log("linkingBreak"),t&&e>-1){var n=this.links.find((function(n){return n.targetID===t.id&&n.targetSlot===e}));if(n){var i=this.blocks.find((function(t){return t.id===n.originID}));this.links=this.links.filter((function(n){return!(n.targetID===t.id&&n.targetSlot===e)})),t.inputs[n.targetSlot].active=!1,i.outputs[n.originSlot].active=!1,this.linkingStart(i,n.originSlot),this.updateModel()}}},getImages:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=["line","circle"],e.prev=1,e.next=4,y.a.toPng(t.$el,{bgcolor:"#00000000",filter:function(t){return!(["btn-zoom"].includes(t.className)||n.includes(t.tagName))}});case 4:return i=e.sent,e.abrupt("return",i);case 8:return e.prev=8,e.t0=e["catch"](1),console.log(e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))()},position:function(t,e){t.position=e},blockSelect:function(t){var e=this;this.$store.dispatch("cascades/deselectBlocks",t),this.$nextTick((function(){e.$store.dispatch("cascades/selectBlock",t)}))},blockDeselect:function(t){t.selected=!1,t&&this.selectedBlock&&this.selectedBlock.id===t.id&&(this.selectedBlock=null),this.$emit("blockDeselect",t)},moveBlock:function(){this.updateModel()},updateModel:function(){this.$store.dispatch("cascades/updateModel")}},mounted:function(){this.$el.addEventListener("mouseenter",this.handleMauseOver),this.$el.addEventListener("mouseleave",this.handleMauseOver),document.documentElement.addEventListener("keyup",this.keyup),document.documentElement.addEventListener("mousemove",this.handleMove,!0),document.documentElement.addEventListener("mousedown",this.handleDown,!0),document.documentElement.addEventListener("mouseup",this.handleUp,!0),document.documentElement.addEventListener("wheel",this.handleWheel,!0),this.centerX=this.$el.clientWidth/2,this.centerY=this.$el.clientHeight/2},beforeDestroy:function(){document.documentElement.removeEventListener("keyup",this.keyup),this.$el.removeEventListener("mouseenter",this.handleMauseOver),this.$el.removeEventListener("mouseleave",this.handleMauseOver),document.documentElement.removeEventListener("mousemove",this.handleMove,!0),document.documentElement.removeEventListener("mousedown",this.handleDown,!0),document.documentElement.removeEventListener("mouseup",this.handleUp,!0),document.documentElement.removeEventListener("wheel",this.handleWheel,!0)}},z=F,H=(n("f4ae"),Object(m["a"])(z,v,g,!1,null,"e7cc6aba",null)),T=H.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"params"},[n("scrollbar",[n("div",{staticClass:"params__items"},[n("div",{staticClass:"params__items--item"},[n("Input",{attrs:{label:"Название блока",type:"text",parse:"name",name:"name",disabled:t.isBlock},on:{change:t.saveModel},model:{value:t.block.name,callback:function(e){t.$set(t.block,"name",e)},expression:"block.name"}})],1),n("at-collapse",{attrs:{value:t.collapse}},[n("at-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.main.length,expression:"main.length"}],staticClass:"mb-3",attrs:{title:"Параметры блока"}},[t._l(t.main,(function(e,i){return[n("t-auto-field-cascade",t._b({key:e.name+i,attrs:{id:e.name,parameters:t.parameters,inline:!1},on:{change:t.change}},"t-auto-field-cascade",e,!1))]}))],2),n("at-collapse-item",{directives:[{name:"show",rawName:"v-show",value:!!t.info,expression:"!!info"}],staticClass:"mb-3",attrs:{title:"Информация о блоке"}},[n("BlockInfo",{attrs:{info:t.info}})],1)],1)],1)])],1)},q=[],U=(n("b0c0"),n("b64b"),n("7d6e")),A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.info?n("div",{staticClass:"info"},[n("div",{staticClass:"info__content",domProps:{innerHTML:t._s(t.info)}})]):t._e()},J=[],K={name:"info-block",props:{info:String}},G=K,Q=(n("5e99"),Object(m["a"])(G,A,J,!1,null,null,null)),Z=Q.exports,tt={name:"Params",components:{Input:U["a"],BlockInfo:Z},data:function(){return{collapse:["0","1","2"],oldBlock:null,debounce:null}},computed:Object(l["a"])(Object(l["a"])({},Object(u["c"])({list:"cascades/getList",layers:"cascades/getLayersType",layersForm:"cascades/getLayersForm",block:"cascades/getBlock",project:"projects/getProject",manual:"cascades/getManual"})),{},{datatypes:function(){var t=this;return this.layersForm.filter((function(e){var n=e.name;return n==="datatype_".concat(t.block.group)}))},isBlock:function(){return!this.block.id},isInput:function(){return"input"===this.block.group},listWithoutOutputInput:function(){return this.list?this.list.filter((function(t){return!("input"===t.value.toLowerCase())})):[]},buttonSave:function(){var t;return(null===(t=this.buttons)||void 0===t?void 0:t.save)||!1},parameters:function(){var t,e;return(null===(t=this.block)||void 0===t||null===(e=t.parameters)||void 0===e?void 0:e.main)||{}},main:function(){var t,e=null===(t=this.block)||void 0===t?void 0:t.group;if(Object.keys(this.layers).length&&e){var n,i=(null===(n=this.layers[e])||void 0===n?void 0:n.main)||[];return i}return[]},info:function(){return this.manual[this.block.group]?this.manual[this.block.group][this.parameters.type]:""}}),methods:{changeId:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("cascades/changeId",t);case 2:case"end":return n.stop()}}),n)})))()},saveModel:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("cascades/updateModel",t.block);case 2:case"end":return e.stop()}}),e)})))()},changeType:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.value,n.next=3,e.$store.dispatch("cascades/typeBlock",{type:i,block:e.block});case 3:case"end":return n.stop()}}),n)})))()},change:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,s,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=t.value,s=t.name,a=t.mounted,e.block.parameters?e.block.parameters["main"][s]=i:e.oldBlock.parameters["main"][s]=i,e.debounce(a);case 3:case"end":return n.stop()}}),n)})))()}},created:function(){var t=this;this.debounce=Object(I["a"])((function(){t.saveModel()}),200)},beforeDestroy:function(){this.debounce(!1)},watch:{block:{handler:function(t,e){this.oldBlock=e,console.log(t,e)}}}},et=tt,nt=(n("44e7c"),Object(m["a"])(et,V,q,!1,null,"506d6a87",null)),it=nt.exports,st=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("at-modal",{attrs:{width:"680",showClose:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.modelDownload,expression:"modelDownload"}],staticClass:"t-model__overlay"},[n("LoadSpiner",{attrs:{text:"Загрузка каскада"}})],1),n("div",{staticClass:"t-model__header",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("Загрузка каскада")]),n("div",{staticClass:"t-model__search"},[n("i",{staticClass:"t-icon icon-search"}),n("t-field",{staticClass:"t-model__field",attrs:{inline:"",label:""}},[n("t-input-new",{ref:"search",staticStyle:{width:"109px"},attrs:{placeholder:"Найти",type:"text",small:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1)]),n("div",{staticClass:"row at-row"},[n("div",{staticClass:"col-16 models-list scroll-area"},[n("scrollbar",[n("ul",{staticClass:"loaded-list"},[t._l(t.lists,(function(e,i){return n("li",{key:"model_"+i,class:["loaded-list__item",{"loaded-list__item--active":t.selected===e.label}],on:{click:function(n){t.getModel(e),t.selected=e.label}}},[n("i",{staticClass:"loaded-list__item--icon"}),n("span",{staticClass:"loaded-list__item--text"},[t._v(t._s(e.label))]),"custom"===e.uid?n("div",{staticClass:"loaded-list__item--remove",on:{click:function(n){return t.removeModel(e.value)}}},[n("i",{staticClass:"t-icon"})]):t._e()])})),t.lists.length?t._e():n("li",{staticClass:"loaded-list__item"},[n("span",{staticClass:"loaded-list__item--empty"},[t._v('Каскад "'+t._s(t.search)+'" не найден')])])],2)])],1),n("div",{staticClass:"col-8"},[t.info.name?n("div",{staticClass:"model-arch"},[n("div",{staticClass:"wrapper hidden"},[n("div",{staticClass:"modal-arch-info"},[n("div",{staticClass:"model-arch-info-param name"},[n("span",[t._v("Name:")]),n("span",[t._v(t._s(t.info.alias?" "+t.info.name:""))])])]),t.info.image?n("div",{staticClass:"model-arch__img my-5"},[n("img",{attrs:{alt:"",width:"100",height:"200",src:"data:image/png;base64,"+t.info.image||!1}})]):t._e(),t.info.image?t._e():n("div",{staticClass:"model-arch__empty"},[n("span",[t._v("Нет картинки")])]),n("div",{staticClass:"model-arch__btn"},[n("t-button",{attrs:{disabled:!t.model||t.loading,loading:t.loading},on:{click:t.download}},[t._v("Загрузить")])],1)])]):t._e()])]),n("div",{attrs:{slot:"footer"},slot:"footer"})])},at=[],ot=(n("ac1f"),n("466d"),n("4d63"),n("25f0"),n("841c"),n("1636")),rt={name:"ModalLoadModel",components:{LoadSpiner:ot["default"]},props:{value:Boolean},data:function(){return{lists:[],info:{},model:null,selected:"",search:"",loading:!0,modelDownload:!1}},mounted:function(){this.$el.getElementsByClassName("at-modal__footer")[0].remove()},created:function(){this.load()},computed:{models:function(){var t,e,n=this;return[].concat(Object(c["a"])(((null===(t=this.lists[0])||void 0===t?void 0:t.models)||[]).map((function(t){return Object(l["a"])(Object(l["a"])({},t),{},{uid:"preset"})}))),Object(c["a"])(((null===(e=this.lists[1])||void 0===e?void 0:e.models)||[]).map((function(t){return Object(l["a"])(Object(l["a"])({},t),{},{uid:"custom"})})))).filter((function(t){return t.label.match(new RegExp(n.search,"i"))}))},dialog:{set:function(t){this.$emit("input",t)},get:function(){return this.value}}},methods:{removeModel:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$Modal.confirm({title:"Внимание!",content:"Уверены, что хотите удалить этот каскад?",width:300,callback:function(){var n=Object(a["a"])(regeneratorRuntime.mark((function n(i){var s,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("confirm"!=i){n.next=6;break}return n.next=3,e.$store.dispatch("cascades/removeModel",{path:t});case 3:s=n.sent,a=s.success,a&&(e.load(),e.selected="",e.info={});case 6:case"end":return n.stop()}}),n)})));function i(t){return n.apply(this,arguments)}return i}()});case 1:case"end":return n.stop()}}),n)})))()},load:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("cascades/info",{});case 2:n=e.sent,i=n.data,i&&(t.lists=i);case 5:case"end":return e.stop()}}),e)})))()},getModel:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.loading=!0,n.next=3,e.$store.dispatch("cascades/getModel",t);case 3:i=n.sent,s=i.data,s&&(e.info=s,e.model=t),e.loading=!1;case 7:case"end":return n.stop()}}),n)})))()},download:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading){e.next=17;break}return t.loading=!0,t.modelDownload=!0,e.next=5,t.$store.dispatch("datasets/validateDatasetOrModel",{model:t.model});case 5:if(n=e.sent,i=n.success,s=n.data,!i||!s){e.next=12;break}t.$Modal.confirm({title:"Внимание!",content:s,width:300,callback:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("confirm"!=n){e.next=3;break}return e.next=3,t.onChoice({reset_dataset:!0});case 3:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()}),e.next=14;break;case 12:return e.next=14,t.onChoice();case 14:t.$emit("input",!1),t.loading=!1,t.modelDownload=!1;case 17:case"end":return e.stop()}}),e)})))()},onChoice:function(){var t=arguments,e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,s,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.length>0&&void 0!==t[0]?t[0]:{},s=i.reset_dataset,a=void 0!==s&&s,n.next=3,e.$store.dispatch("cascades/load",{model:e.model,reset_dataset:a});case 3:case"end":return n.stop()}}),n)})))()}},watch:{dialog:{handler:function(t){var e=this;t&&(this.$nextTick((function(){e.$refs.search.label()})),this.load())}}}},ct=rt,lt=(n("a657"),Object(m["a"])(ct,st,at,!1,null,"66d2119a",null)),ut=lt.exports,dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("at-modal",{attrs:{width:"400",showClose:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("div",{staticStyle:{"text-align":"center"},attrs:{slot:"header"},slot:"header"},[n("span",[t._v("Сохранить каскад")])]),n("div",{staticClass:"model modal-save-model"},[n("div",{staticClass:"model__image"},[t.image?n("img",{attrs:{alt:"",width:"auto",height:"auto",src:"data:image/png;base64,"+t.image||!1}}):n("Loading",{staticClass:"model__image--loading"})],1),n("div",{staticClass:"model__config"},[n("t-input",{key:"name-key",attrs:{value:t.name,label:"Название модели",type:"text",parse:"parse",name:"name",error:t.err},on:{focus:function(e){t.err=""},change:function(e){t.name=e.value}}}),n("t-checkbox",{key:"overwrite",attrs:{inline:"",value:t.overwrite,label:"Перезаписать",type:"checkbox",parse:"test",name:"overwrite"},on:{change:function(e){t.overwrite=e.value}}})],1)]),n("template",{slot:"footer"},[n("t-button",{attrs:{disabled:!t.image},nativeOn:{click:function(e){return t.save.apply(null,arguments)}}},[t._v("Сохранить")]),n("t-button",{attrs:{cancel:""},nativeOn:{click:function(e){return t.close.apply(null,arguments)}}},[t._v("Отменить")])],1)],2)},ht=[],mt=n("8f6b"),ft={name:"ModalSaveModel",components:{Loading:mt["a"]},props:{value:Boolean,image:String},data:function(){return{name:"",overwrite:!1,err:""}},computed:{dialog:{set:function(t){this.$emit("input",t)},get:function(){return this.value}}},methods:{change:function(t){console.log(t)},save:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,s,a,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.image){e.next=23;break}return e.next=3,t.$store.dispatch("cascades/createModel",{name:t.name,image:t.image,overwrite:t.overwrite});case 3:if(s=e.sent,null===s||void 0===s||!s.error||null===s||void 0===s||null===(n=s.error)||void 0===n||!n.general){e.next=10;break}return e.next=7,t.$store.dispatch("messages/setMessage",{error:"Каскад '".concat(t.name,"' уже создана")});case 7:t.err="Каскад '".concat(t.name,"' уже создана"),e.next=18;break;case 10:if(null===s||void 0===s||null===(i=s.error)||void 0===i||!i.fields){e.next=16;break}return t.err=null===s||void 0===s||null===(a=s.error)||void 0===a||null===(o=a.fields)||void 0===o?void 0:o.alias,e.next=14,t.$store.dispatch("messages/setMessage",{error:null===s||void 0===s||null===(r=s.error)||void 0===r?void 0:r.fields});case 14:e.next=18;break;case 16:return e.next=18,t.$store.dispatch("messages/setMessage",{error:null===s||void 0===s?void 0:s.error});case 18:if(console.log("this.err ".concat(t.err)),t.err){e.next=23;break}return t.dialog=!1,e.next=23,t.$store.dispatch("messages/setMessage",{message:"Каскад '".concat(t.name,"' сохранен")});case 23:case"end":return e.stop()}}),e)})))()},close:function(){this.dialog=!1}},watch:{dialog:{handler:function(t){t&&console.log(this.refs)}}}},pt=ft,vt=(n("bd1f"),Object(m["a"])(pt,dt,ht,!1,null,"49e2b89a",null)),gt=vt.exports,kt=n("0ba0"),bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("at-modal",{attrs:{width:"400",okText:"Выбрать",title:"Запуск",showConfirmButton:t.isReady},on:{"on-confirm":t.confirm},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("div",{staticClass:"t-modal-datasets"},[t._l(t.inputBlocks,(function(e,i){return[n("t-field",{key:i,attrs:{label:e.name}},[n("t-auto-complete-new",{attrs:{list:t.filters,placeholder:"Выберите датасет"},on:{change:function(n){return t.change(e.id,n)}}})],1)]}))],2)])},yt=[],xt={name:"ModalDatasets",components:{},props:{value:Boolean},data:function(){return{selected:{}}},computed:Object(l["a"])(Object(l["a"])({dialog:{set:function(t){this.$emit("input",t)},get:function(){return this.value}}},Object(u["c"])({getBlocks:"cascades/getBlocks",datasets:"cascades/getDatasets"})),{},{filters:function(){return this.datasets.map((function(t){return{label:t.label,value:t.alias}}))},inputBlocks:function(){return this.getBlocks.filter((function(t){return"InputData"===t.group}))},isReady:function(){return Object.keys(this.selected).length===this.inputBlocks.length}}),methods:{change:function(t,e){var n=e.value,i=this.datasets.find((function(t){return t.alias===n}));if(i){var s=i.alias,a=i.group;this.selected[t]={alias:s,group:a},this.selected=Object(l["a"])({},this.selected)}},confirm:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.isReady){e.next=2;break}return e.abrupt("return",t.$store.dispatch("messages/setMessage",{error:"Выберите датасеты"}));case 2:return t.$store.dispatch("settings/setOverlay",!0),e.next=5,t.$store.dispatch("cascades/start",t.selected);case 5:t.createInterval();case 6:case"end":return e.stop()}}),e)})))()},createInterval:function(){var t=this;this.interval=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,s,a,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("cascades/startProgress");case 2:if(n=e.sent,!n){e.next=28;break}if(i=n.data,!i){e.next=25;break}if(s=i.finished,a=i.message,o=i.percent,r=i.error,t.$store.dispatch("messages/setProgressMessage",a),t.$store.dispatch("messages/setProgress",o),!s){e.next=17;break}return t.$store.dispatch("messages/setProgress",0),t.$store.dispatch("messages/setProgressMessage",""),e.next=14,t.$store.dispatch("projects/get");case 14:t.$store.dispatch("settings/setOverlay",!1),e.next=23;break;case 17:if(!r){e.next=22;break}return t.$store.dispatch("messages/setProgressMessage",""),t.$store.dispatch("messages/setProgress",0),t.$store.dispatch("settings/setOverlay",!1),e.abrupt("return");case 22:t.createInterval();case 23:e.next=26;break;case 25:t.$store.dispatch("settings/setOverlay",!1);case 26:e.next=29;break;case 28:t.$store.dispatch("settings/setOverlay",!1);case 29:case"end":return e.stop()}}),e)}))),1e3)}}},_t=xt,wt=(n("492b"),Object(m["a"])(_t,bt,yt,!1,null,"0ade1265",null)),Ct=wt.exports,Mt={name:"cascades",components:{Toolbar:p,Blocks:T,Params:it,LoadModel:ut,SaveModel:gt,CopyModal:kt["a"],DatasetsModal:Ct},data:function(){return{dialogLoadModel:!1,dialogSaveModel:!1,dialogDatasets:!1,imageModel:null,kerasModal:!1}},computed:{keras:function(){var t;return(null===(t=this.$store.getters["cascades/getModel"])||void 0===t?void 0:t.keras)||""}},methods:{isTraining:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("dialogs/trining",{ctx:t,page:"модели"});case 2:t.dialogLoadModel=e.sent;case 3:case"end":return e.stop()}}),e)})))()},addBlock:function(t){var e=this.$refs.container.getCenter();this.create=!1,this.$store.dispatch("cascades/addBlock",{type:t,position:e})},save:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.imageModel=null,t.dialogSaveModel=!0,e.next=4,t.$refs.container.getImages();case 4:return n=e.sent,e.next=7,t.$store.dispatch("cascades/getImageModel",n.slice(22));case 7:i=e.sent,s=i.data,a=void 0===s?null:s,a&&(t.imageModel=a);case 11:case"end":return e.stop()}}),e)})))()},start:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.dialogDatasets=!0,e.next=3,t.$store.dispatch("cascades/setDatasets");case 3:case"end":return e.stop()}}),e)})))()},validation:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("cascades/validate",{});case 2:case"end":return e.stop()}}),e)})))()},clearModel:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("dialogs/confirm",{ctx:t,content:"Очистить модель?"});case 2:if(n=e.sent,"confirm"!=n){e.next=6;break}return e.next=6,t.$store.dispatch("cascades/clearModel");case 6:case"end":return e.stop()}}),e)})))()},actions:function(t){"load"===t&&this.isTraining(),["InputData","Model","Function","Custom","Service","OutputData"].includes(t)&&(console.log(t),this.addBlock(t)),"start"===t&&this.start(),"save"===t&&this.save(),"validation"===t&&this.validation(),"clear"===t&&this.clearModel(),"keras"===t&&(this.kerasModal=!0)}}},$t=Mt,Dt=(n("d1b7"),Object(m["a"])($t,i,s,!1,null,"5e0b990e",null));e["default"]=Dt.exports},f4ae:function(t,e,n){"use strict";n("1ee4")},fbf1:function(t,e,n){}}]);